Creative foundation
===================

Набор полезных расширений, которые пригодятся в каждом проекте.


Компоненты
==========

Content
-------

Выводит контент на сайте согласно структуре инфоблока с контентом, с учетом иерархии вложенных папок. Попытка перенести весь контент из файлов в базу данных. Дополнительно: расставляем мета-теги согласно seo-настройкам инфоблока, выстраивает лебные крошки согласно структуре разделов, для каждой страницы может быть настроен отдельный шаблон отображения, отображает страницу 404, если элемент не найден.

Параметры компонента.

1. **IBLOCK_ID** string, int - идентификатор или символьный код инфоблока, из которого нужно вывести контент, по умолчанию `content`.

2. **TEMPLATE_PROPERTY** string - код свойства инфоблока с контентом, в котором хранится название шаблона для данной страницы (для разделов будет автоматически добавлен префикс `UF_`, для элементов `PROPERTY_`), если для отображаемой страницы будет указано свойство с шаблоном для данного элемента, то компонент попробует найти файл с таким именем в папке текущего шаблона компонента и отобразить его, если свойство с шаблоном не указано, то будет отображен `template.php` из папки текущего шаблона компонента. По умолчанию `template`.

3. **PARAM_PROPERTY** string - код свойства инфоблока с контентом, в котором хранятся параметры, которые нужно передать в шаблон данной страницы. Свойство должно быть строковы, множественным, с включенным описанием значения, в `$arResult['current']` будет передан массив, ключами которого будут значения свойства, а значениями - описания значений свойства.

4. **ACCESS_PROPERTY** string - код свойства инфоблока с контентом, в котором хранятся строки с символьными кодами групп, для которых доступен просмотр данной страницы. Свойство должно быть строковы, множественным.

4. **COMPLEX_PAGE_PROPERTY** string - код свойства инфоблока с контентом, в котором установлен флаг есть ли на странице комплексный компонент. Например, для элемента с символьным кодом `news` при отключенном параметре **COMPLEX_PAGE_PROPERTY** ссылка `/news/news-1/` вернет 404. в то же время при включенном параметре **COMPLEX_PAGE_PROPERTY** и установленным флагом в соответствующем параметре элемента с символьным кодом `news` для ссылки `/news/news-1/` подгрузится именно этот элемент, после чего управление ЧПУ будет передано элементу `news`.

5. **URL** string - url, который должен быть обработан компонентом. По умолчанию `Application::getInstance()->getContext()->getRequest()->getRequestedPage()`.

6. **CACHE_TIME** int - время жизни кэша компонента в секундах.

7. **PAGE_404** string - путь до страницы с ошибкой 404, которая будет отображена, если элемент не найден.

8. **PAGE_403** string - путь до страницы, на которую следует переадресовать неавторизованного пользователя, если ему недоступен просмотр страницы.

9. **SET_META** string(Y|N) - флаг, который обозначает нужно или нет устанавливать мета-теги.

10. **SET_BREADCRUMBS** string(Y|N) - флаг, который обозначает нужно или нет устанавливать хлебные крошки.

Рекомендуется вызывать исключительно на главной странице, с включенным ЧПУ, чтобы компонент заменял собой все остальные страницы.

```php
<?php
require_once($_SERVER['DOCUMENT_ROOT'].'/bitrix/modules/main/include/prolog_before.php');

$r = \Bitrix\Main\Application::getInstance()->getContext()->getRequest();
if (!$r->isAjaxRequest()) require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");

/*
внимание! данная страница является аналогом входного скрипта
все данные лежат в инфоблоке "Страницы"
все шаблоны лежат внутри шаблона компонента local/templates/.default/components/creative.foundation/content
*/
$APPLICATION->IncludeComponent("creative.foundation:content", "", Array(
	"COMPONENT_TEMPLATE" => "",
		"SEF_MODE" => "Y",	// Включить поддержку ЧПУ
		"SEF_FOLDER" => "/",	// Каталог ЧПУ (относительно корня сайта)
		"IBLOCK_ID" => "",	// ID или код инфоблока
		"TEMPLATE_PROPERTY" => "template",	// Свойство инфоблока, в котором хранится шаблон
		"PARAM_PROPERTY" => "",	// Свойство инфоблока, в котором хранятся параметры страницы
		"PAGE_404" => "/404.php",	// Путь до страницы с ошибкой 404
		"SET_META" => "Y",	// Устанавливать мета-заголовки
		"SET_BREADCRUMBS" => "Y",	// Устанавливать хлебные крошки
		"CACHE_TYPE" => "A",	// Тип кеширования
		"CACHE_TIME" => "86400",	// Время кеширования (сек.)
	),
	false

if (!$r->isAjaxRequest()) require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");
```


Includes
--------

Выводит включаемые области из элементов инфоблока в базе данных. попытка заменить в ключаемые области из файлов на базу данных.

Параметры компонента.

1. **IBLOCK_ID** string, int - идентификатор или символьный код инфоблока, из которого нужно вывести контент, по умолчанию `includes`.

2. **CODE** string - код элемента инфоблока, который хранит в себе контент данной включаемой области.

3. **CACHE_TIME** int - время жизни кэша компонента в секундах.

4. **IS_SILENT** string(Y|N) - флаг, который обозначает нужно или не нужно отображать шаблон копмонента. В случае, если требуется значение включаемой области без его отображения в шаблоне, можно установить данный флаг и вызов компонента вернет массив с содержимым включаемой области, без отображения шаблона.

```php
<div class="re-container">
    <div class="re-header-panel">
        <?php $APPLICATION->IncludeComponent('creative.foundation:includes', 'header_address', array(
                'CODE' => 'header_address',
            ),
            false
        ); ?>
        <?php $APPLICATION->IncludeComponent('creative.foundation:includes', 'header_logo', array(
                'CODE' => 'header_logo',
            ),
            false
        ); ?>
        <div class="re-header-panel__record">
            <a class="re-btn re-btn_red ms_booking" href="#">Записаться онлайн</a>
        </div>
    </div>
</div>
```


Iblock menu
-----------

Позволяет хранить меню в инфоблоке и формировать многоуровневое меню согласно иерархии инфоблока. В качестве имени ссылки выводит имя элемента, а в качестве `href` символьный код элемента.

Параметры компонента.

1. **IBLOCK_ID** string, int - идентификатор или символьный код инфоблока, из которого нужно вывести меню, по умолчанию `menu`.

2. **SECTION_ID** string, int - идентификатор или символьный код раздела инфоблока, для которого нужно построить меню. С помощью него можно разделять меню по типам, для каждого типа меню должна быть создан верхнеуровневый раздел с соответствующим символьным кодом, например, `top`.

3. **CACHE_TIME** int - время жизни кэша компонента в секундах.

Данный компонент лучше всего подключать в файлах `.*.menu_ext.php`.

```php
<?php
    if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die();
    global $APPLICATION;
    $aMenuLinksExt = $APPLICATION->IncludeComponent(
        'creative.foundation:iblock_menu',
        '',
        [
            'IBLOCK_ID' => 'menu',
            'SECTION_ID' => 'top',
        ],
        $component
    );
    $aMenuLinks = array_merge($aMenuLinks, $aMenuLinksExt);
```


Сервисы
=======

Iblocklocator
-------------

Сервис, который помогает быстро и без лишних запросов к базе данных искать описания инфоблоков.

Методы.

1. `int Iblocklocator::getIdByCode ( string $code )` - возвращает идентификатор инфоблока по его символьному коду.

2. `string Iblocklocator::getCodeById ( int $id )` - возвращает символьный код инфоблока по его идентификатору.

3. `mixed Iblocklocator::findBy( string $field, mixed $value [, string $select = null] )` - возвращает массив с описанием инфоблока с поиском по полю `$field`, которое должно быть равно `$value`. В случае если указан параметр `$select`, то вернет только значение данного поля.

Перед обращением к сервису следует подключить модуль `creative.foundation`.

```php
<?php
    if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

    \Bitrix\Main\Loader::includeModule('creative.foundation');
    $iblock = \Bitrix\Main\Application::getInstance()->iblocklocator->findBy('CODE', 'actions');
?>
<?$APPLICATION->IncludeComponent("bitrix:news", "actions", Array(
    "COMPONENT_TEMPLATE" => ".default",
    "IBLOCK_TYPE" => $iblock['IBLOCK_TYPE_ID'],
    "IBLOCK_ID" => $iblock['ID'],
```
